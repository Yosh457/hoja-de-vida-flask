{% extends "base.html" %}
{% block title %}Crear Comentario{% endblock %}
{% block content %}
<div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-3xl mx-auto my-12">
    <div class="border-b pb-4 mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Crear Comentario para: <span class="text-blue-600">{{ funcionario.nombre_completo }}</span></h2>
    </div>

    <form method="post" class="space-y-6">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div>
            <label for="tipo" class="block text-sm font-medium text-gray-700">Tipo de Comentario</label>
            <select name="tipo" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                <option value="" disabled selected>Selecciona el tipo</option>
                <option value="Favorable">Favorable</option>
                <option value="Desfavorable">Desfavorable</option>
            </select>
        </div>

        <div>
            <label for="factor_id" class="block text-sm font-medium text-gray-700">Factor Asociado</label>
            <select id="factor-select" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg" required>
                <option value="" disabled selected>Selecciona un factor para filtrar</option>
                {% for factor in factores %}
                    <option value="{{ factor.id }}">{{ factor.nombre }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="subfactor_id" class="block text-sm font-medium text-gray-700">Sub-Factor Asociado</label>
            <select name="subfactor_id" id="subfactor-select" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg" required disabled>
                <option value="" disabled selected>Selecciona un factor primero...</option>
                {% for subfactor in subfactores %}
                    <option value="{{ subfactor.id }}" data-factor-id="{{ subfactor.factor_id }}">{{ subfactor.factor.nombre }} - {{ subfactor.nombre }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div>
            <label for="motivo_jefe" class="block text-sm font-medium text-gray-700">Argumentos / Observaciones</label>
            <textarea name="motivo_jefe" rows="5" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg" required></textarea>
        </div>

        <div class="flex justify-end gap-4 pt-6 border-t mt-8">
            {% if current_user.rol.nombre == 'Jefa Salud' %}
                <a href="{{ url_for('jefa_salud.panel_jefa_salud') }}" class="btn btn-secondary">Cancelar</a>
            
            {% elif current_user.rol.nombre == 'Encargado de Recinto' %}
                <a href="{{ url_for('recinto.panel_encargado_recinto') }}" class="btn btn-secondary">Cancelar</a>

            {% elif current_user.rol.nombre == 'Encargado de Unidad' %}
                <a href="{{ url_for('unidad.panel_encargado_unidad') }}" class="btn btn-secondary">Cancelar</a>
            
            {% else %} {# Fallback para Admin #}
                <a href="{{ url_for('admin.admin_panel') }}" class="btn btn-secondary">Cancelar</a>
            {% endif %}
            
            <button type="submit" class="btn btn-primary">Crear Comentario</button>
        </div>
    </form>
</div>

<script src="{{ url_for('static', filename='form_helper.js') }}"></script>

{% endblock %}